window.GFDropboxSettings=null,function(a){GFDropboxSettings=function(){var b=this;this.init=function(){this.initialValues={appKey:this.getAppKey(),appSecret:this.getAppSecret()},this.bindAppKeyUpdate(),this.bindDeauthorize(),this.setupValidationIcons(),a("#gform-settings-save").hide()},this.bindAppKeyUpdate=function(){a("input#customAppKey, input#customAppSecret").on("blur",this.checkAppKeyValidity)},this.bindDeauthorize=function(){a("#gform_dropbox_deauth_button").on("click",function(b){b.preventDefault(),a('input[name="_gaddon_setting_accessToken"], input[name="_gaddon_setting_defaultAppEnabled"]').val(""),a("#gform-settings-save").trigger("click")})},this.checkAppKeyValidity=function(){b.getAppKey()===b.initialValues.appKey&&b.getAppSecret()===b.initialValues.appSecret||(b.lockAppKeyFields(!0),b.resetAppKeyStatus(),a.ajax({url:ajaxurl,dataType:"json",type:"GET",data:{action:"gfdropbox_valid_app_key_secret",app_key:b.getAppKey(),app_secret:b.getAppSecret()},success:function(a){b.setAppKeyStatus(a.valid_app_key,a.auth_url),b.lockAppKeyFields(!1)}}))},this.getAppKey=function(){return a("input#customAppKey").val()},this.getAppSecret=function(){return a("input#customAppSecret").val()},this.lockAppKeyFields=function(b){a("input#customAppKey, input#customAppSecret").prop("disabled",b)},this.resetAppKeyStatus=function(){a("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid")},this.setAppKeyStatus=function(b,c){b===!0&&(a("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-check fa-check gf_valid"),a("#gform_dropbox_auth_message").hide(),location.reload()),b===!1&&a("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-remove fa-times gf_invalid"),b!==!1&&null!==b||(a("#gform_dropbox_auth_message").show(),a("#gform_dropbox_auth_button").hide())},this.setupValidationIcons=function(){0==a("#gaddon-setting-row-customAppKey .fa").length&&a(' <i class="fa"></i>').insertAfter(a("#customAppKey")),0==a("#gaddon-setting-row-customAppSecret .fa").length&&a('<i class="fa"></i>').insertAfter(a("#customAppSecret"))},this.init()},a(document).ready(GFDropboxSettings)}(jQuery);